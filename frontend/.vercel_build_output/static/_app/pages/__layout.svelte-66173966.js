import{S as s,i as e,s as t,e as o,t as a,k as n,c as r,a as l,g as c,d as i,o as u,b as p,f,E as d,F as h,G as m,H as g,I as $,J as v,K as w,L as y,M as x,N as b,j as E,l as N,n as j,p as A,v as I,x as k,y as L,w as U,B,u as P,h as T,O,P as V,Q as D,R as S}from"../chunks/vendor-6f853f0b.js";import{u as R,j as z,A as F}from"../chunks/Env-f59ff4d0.js";import{p as H}from"../chunks/postStore-85fc39d6.js";function M(s){let e,t,w,y,x,b,E,N,j,A,I,k,L,U,B,P,T,O,V,D,S,R;return{c(){e=o("form"),t=o("div"),w=o("div"),y=o("h2"),x=a("ลงชื่อเข้าใช้"),b=n(),E=o("div"),N=o("label"),j=a("รหัสผู้ใช้"),A=n(),I=o("input"),k=n(),L=o("div"),U=o("label"),B=a("รหัสผ่าน"),P=n(),T=o("input"),O=n(),V=o("button"),D=a("เข้าสู่ระบบ"),this.h()},l(s){e=r(s,"FORM",{});var o=l(e);t=r(o,"DIV",{class:!0});var a=l(t);w=r(a,"DIV",{class:!0});var n=l(w);y=r(n,"H2",{class:!0});var p=l(y);x=c(p,"ลงชื่อเข้าใช้"),p.forEach(i),b=u(n),E=r(n,"DIV",{class:!0});var f=l(E);N=r(f,"LABEL",{for:!0,class:!0});var d=l(N);j=c(d,"รหัสผู้ใช้"),d.forEach(i),A=u(f),I=r(f,"INPUT",{type:!0,id:!0,name:!0,class:!0}),f.forEach(i),k=u(n),L=r(n,"DIV",{class:!0});var h=l(L);U=r(h,"LABEL",{for:!0,class:!0});var m=l(U);B=c(m,"รหัสผ่าน"),m.forEach(i),P=u(h),T=r(h,"INPUT",{type:!0,id:!0,name:!0,class:!0}),h.forEach(i),O=u(n),V=r(n,"BUTTON",{type:!0,class:!0});var g=l(V);D=c(g,"เข้าสู่ระบบ"),g.forEach(i),n.forEach(i),a.forEach(i),o.forEach(i),this.h()},h(){p(y,"class","text-gray-900 text-lg font-medium title-font mb-5"),p(N,"for","full-name"),p(N,"class","leading-7 text-sm text-gray-600"),p(I,"type","text"),p(I,"id","username"),p(I,"name","username"),p(I,"class","w-full bg-white rounded border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"),p(E,"class","relative mb-4"),p(U,"for","password"),p(U,"class","leading-7 text-sm text-gray-600"),p(T,"type","password"),p(T,"id","password"),p(T,"name","password"),p(T,"class","w-full bg-white rounded border border-gray-300 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out"),p(L,"class","relative mb-4"),p(V,"type","submit"),p(V,"class","text-white bg-purple-500 border-0 py-2 px-8 focus:outline-none hover:bg-purple-600 rounded text-lg"),p(w,"class","lg:w-2/6 md:w-1/2 bg-gray-100 rounded-lg p-8 flex flex-col md:ml-auto w-full mt-10 md:mt-0"),p(t,"class","animate container px-5 py-24 mx-auto flex flex-wrap items-center transition-all svelte-cizn6n")},m(o,a){f(o,e,a),d(e,t),d(t,w),d(w,y),d(y,x),d(w,b),d(w,E),d(E,N),d(N,j),d(E,A),d(E,I),h(I,s[0]),d(w,k),d(w,L),d(L,U),d(U,B),d(L,P),d(L,T),h(T,s[1]),d(w,O),d(w,V),d(V,D),S||(R=[m(I,"input",s[3]),m(T,"input",s[4]),m(e,"submit",g(s[2]))],S=!0)},p(s,[e]){1&e&&I.value!==s[0]&&h(I,s[0]),2&e&&T.value!==s[1]&&h(T,s[1])},i:$,o:$,d(s){s&&i(e),S=!1,v(R)}}}function W(s,e,t){let o,a,n,r,l;return w(s,R,(s=>t(6,o=s))),w(s,z,(s=>t(7,a=s))),[n,r,async function(){const s=await fetch(`https://dmsxupload.pea.co.th/tests3/api/password/get?username=${n}&password=${r}`),e=await s.json();console.log(e);const[t,c,i,u,p,...f]=e.split(",");c&&i&&y.post(F+"/auth/local",{identifier:n,password:r,displayName:`${c} ${i}`,profile:`${u},${p},${f},${t}`}).then((s=>{console.log("Well done!"),console.log("User profile",x(R,o=s.data.user,o)),console.log("User token",x(z,a=s.data.jwt,a))})).catch((s=>{!async function(){const s=await fetch(`https://dmsxupload.pea.co.th/tests3/api/password/get?username=${n}&password=${r}`),e=await s.json();console.log(e);const[t,a,c,i,u,...p]=e.split(",");a&&c&&(l=l||n+"@pea.co.th",y.post(F+"/auth/local/register",{username:n,email:l,password:r,displayName:`${a} ${c}`,profile:`${i},${u},${p},${t}`}).then((s=>{console.log("Well done!"),console.log("User profile",x(R,o=s.data.user,o)),console.log("User token",x(R,o=s.data.jwt,o))})).catch((s=>{console.log("An error occurred:",s.response)})))}(),console.log("An error occurred:",s.response)}))},function(){n=this.value,t(0,n)},function(){r=this.value,t(1,r)}]}class X extends s{constructor(s){super(),e(this,s,W,M,t,{})}}function C(s){let e,t,a,n;return{c(){e=o("div"),t=o("input"),this.h()},l(s){e=r(s,"DIV",{class:!0});var o=l(e);t=r(o,"INPUT",{type:!0,placeholder:!0,class:!0}),o.forEach(i),this.h()},h(){p(t,"type","search"),p(t,"placeholder","พิมพ์คำเพื่อค้นหา"),p(t,"class","items-center text-3xl font-bold outline-none rounded-md shadow-md"),p(e,"class","grid place-items-center")},m(o,r){f(o,e,r),d(e,t),h(t,s[0]),a||(n=m(t,"input",s[2]),a=!0)},p(s,[e]){1&e&&h(t,s[0])},i:$,o:$,d(s){s&&i(e),a=!1,n()}}}function G(s,e,t){let o;w(s,H,(s=>t(3,o=s)));let{posts:a}=e,n="";const r=new b(a,{keys:["title","content"]});return s.$$set=s=>{"posts"in s&&t(1,a=s.posts)},s.$$.update=()=>{3&s.$$.dirty&&x(H,o=n?r.search(n).map((s=>s.item)):a,o)},[n,a,function(){n=this.value,t(0,n)}]}class J extends s{constructor(s){super(),e(this,s,G,C,t,{posts:1})}}function K(s){let e,t,h,g,$,v,w,y,x,b,E=s[2].username+"";return{c(){e=o("a"),t=a("New"),h=n(),g=o("span"),$=a(E),v=n(),w=o("button"),y=a("Logout"),this.h()},l(s){e=r(s,"A",{href:!0,class:!0});var o=l(e);t=c(o,"New"),o.forEach(i),h=u(s),g=r(s,"SPAN",{class:!0});var a=l(g);$=c(a,E),a.forEach(i),v=u(s),w=r(s,"BUTTON",{});var n=l(w);y=c(n,"Logout"),n.forEach(i),this.h()},h(){p(e,"href","/blog/new"),p(e,"class","font-mono no-underline mr-3"),p(g,"class","font-mono text-gray-500")},m(o,a){f(o,e,a),d(e,t),f(o,h,a),f(o,g,a),d(g,$),f(o,v,a),f(o,w,a),d(w,y),x||(b=m(w,"click",s[3]),x=!0)},p(s,e){4&e&&E!==(E=s[2].username+"")&&T($,E)},d(s){s&&i(e),s&&i(h),s&&i(g),s&&i(v),s&&i(w),x=!1,b()}}}function Q(s){let e,t,h,m,g;return{c(){e=o("a"),t=a("Login"),h=n(),m=o("a"),g=a("Register"),this.h()},l(s){e=r(s,"A",{href:!0,class:!0});var o=l(e);t=c(o,"Login"),o.forEach(i),h=u(s),m=r(s,"A",{href:!0,class:!0});var a=l(m);g=c(a,"Register"),a.forEach(i),this.h()},h(){p(e,"href","/login"),p(e,"class","font-mono no-underline"),p(m,"href","/register"),p(m,"class","font-mono no-underline")},m(s,o){f(s,e,o),d(e,t),f(s,h,o),f(s,m,o),d(m,g)},p:$,d(s){s&&i(e),s&&i(h),s&&i(m)}}}function q(s){let e,t;return e=new X({}),{c(){E(e.$$.fragment)},l(s){j(e.$$.fragment,s)},m(s,o){A(e,s,o),t=!0},p:$,i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){I(e.$$.fragment,s),t=!1},d(s){U(e,s)}}}function Y(s){let e,t,o=!s[1]&&Z(s);return{c(){o&&o.c(),e=N()},l(s){o&&o.l(s),e=N()},m(s,a){o&&o.m(s,a),f(s,e,a),t=!0},p(s,t){s[1]?o&&(P(),I(o,1,1,(()=>{o=null})),k()):o?(o.p(s,t),2&t&&L(o,1)):(o=Z(s),o.c(),L(o,1),o.m(e.parentNode,e))},i(s){t||(L(o),t=!0)},o(s){I(o),t=!1},d(s){o&&o.d(s),s&&i(e)}}}function Z(s){let e;const t=s[5].default,o=S(t,s,s[4],null);return{c(){o&&o.c()},l(s){o&&o.l(s)},m(s,t){o&&o.m(s,t),e=!0},p(s,a){o&&o.p&&(!e||16&a)&&O(o,t,s,s[4],e?D(t,s[4],a,null):V(s[4]),null)},i(s){e||(L(o,s),e=!0)},o(s){I(o,s),e=!1},d(s){o&&o.d(s)}}}function _(s){let e,t,h,m,g,$,v,w,y,x,b,B,T;function O(s,e){return s[2]?K:Q}$=new J({props:{posts:s[0]}});let V=O(s),D=V(s);const S=[Y,q],R=[];function z(s,e){return s[2]?0:1}return x=z(s),b=R[x]=S[x](s),{c(){e=o("nav"),t=o("div"),h=o("a"),m=a("P B O X"),g=n(),E($.$$.fragment),v=n(),w=o("section"),D.c(),y=n(),b.c(),B=N(),this.h()},l(s){e=r(s,"NAV",{class:!0});var o=l(e);t=r(o,"DIV",{class:!0});var a=l(t);h=r(a,"A",{href:!0,class:!0});var n=l(h);m=c(n,"P B O X"),n.forEach(i),g=u(a),j($.$$.fragment,a),v=u(a),w=r(a,"SECTION",{});var p=l(w);D.l(p),p.forEach(i),a.forEach(i),o.forEach(i),y=u(s),b.l(s),B=N(),this.h()},h(){p(h,"href","/"),p(h,"class","font-bold no-underline"),p(t,"class","flex items-center justify-between container mx-auto"),p(e,"class","bg-white border-b border-gray-500 py-6 px-4 w-full")},m(s,o){f(s,e,o),d(e,t),d(t,h),d(h,m),d(t,g),A($,t,null),d(t,v),d(t,w),D.m(w,null),f(s,y,o),R[x].m(s,o),f(s,B,o),T=!0},p(s,[e]){const t={};1&e&&(t.posts=s[0]),$.$set(t),V===(V=O(s))&&D?D.p(s,e):(D.d(1),D=V(s),D&&(D.c(),D.m(w,null)));let o=x;x=z(s),x===o?R[x].p(s,e):(P(),I(R[o],1,1,(()=>{R[o]=null})),k(),b=R[x],b?b.p(s,e):(b=R[x]=S[x](s),b.c()),L(b,1),b.m(B.parentNode,B))},i(s){T||(L($.$$.fragment,s),L(b),T=!0)},o(s){I($.$$.fragment,s),I(b),T=!1},d(s){s&&i(e),U($),D.d(),s&&i(y),R[x].d(s),s&&i(B)}}}var ss=function(s,e,t,o){return new(t||(t=Promise))((function(a,n){function r(s){try{c(o.next(s))}catch(e){n(e)}}function l(s){try{c(o.throw(s))}catch(e){n(e)}}function c(s){var e;s.done?a(s.value):(e=s.value,e instanceof t?e:new t((function(s){s(e)}))).then(r,l)}c((o=o.apply(s,e||[])).next())}))};const es=({fetch:s})=>ss(void 0,void 0,void 0,(function*(){const e=yield s("/posts");return{props:{posts:yield e.json()}}}));function ts(s,e,t){let o,a;w(s,R,(s=>t(2,o=s))),w(s,z,(s=>t(6,a=s)));let{$$slots:n={},$$scope:r}=e,{posts:l=[]}=e,c=!0;return B((async()=>{if(!localStorage.getItem("token"))return t(1,c=!1),{props:{user:null}};const s=await fetch(F+"/auth/me",{headers:{Authorization:"Bearer "+a}});t(1,c=!1),s.ok&&x(R,o=await s.json(),o)})),s.$$set=s=>{"posts"in s&&t(0,l=s.posts),"$$scope"in s&&t(4,r=s.$$scope)},[l,c,o,async function(){x(R,o=null,o)},r,n]}class os extends s{constructor(s){super(),e(this,s,ts,_,t,{posts:0})}}export{os as default,es as load};
